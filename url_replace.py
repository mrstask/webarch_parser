import chardet
from yarl import URL
import re
url_dicts = \
{'http://www.elgordo.ru/': {'page_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/', 'response': 200}, 'http://www.elgordo.ru:80/img/bun.swf': {'page_url': '/web/20150925074252oe_/http://www.elgordo.ru:80/img/bun.swf', 'webarch_url': 'https://web.archive.org/web/20150925074252oe_/http://www.elgordo.ru:80/img/bun.swf', 'response': 200}, 'http://www.elgordo.ru:80/img/eurom.jpg': {'page_url': '/web/20150925074252im_/http://www.elgordo.ru:80/img/eurom.jpg', 'webarch_url': 'https://web.archive.org/web/20150925074252im_/http://www.elgordo.ru:80/img/eurom.jpg', 'response': 200}, 'http://www.elgordo.ru/feedback.html': {'page_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/feedback.html', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/feedback.html', 'response': 200}, 'http://www.elgordo.ru:80/img/bruho.jpg': {'page_url': '/web/20150925074252im_/http://www.elgordo.ru:80/img/bruho.jpg', 'webarch_url': 'https://web.archive.org/web/20150925074252im_/http://www.elgordo.ru:80/img/bruho.jpg', 'response': 200}, 'http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0': {'page_url': 'https://web.archive.org/web/20150925074252oe_/http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0', 'webarch_url': 'https://web.archive.org/web/20150925074252oe_/http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0', 'response': 200}, 'http://www.elgordo.ru/football.html': {'page_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/football.html', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/football.html', 'response': 200}, 'http://www.elgordo.ru/newsy.html': {'page_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/newsy.html', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/newsy.html', 'response': 200}, 'http://www.elgordo.ru/img/bun.swf': {'page_url': '/img/bun.swf', 'webarch_url': 'none', 'response': 200}, 'http://www.elgordo.ru:80/img/footbal.jpg': {'page_url': '/web/20150925074252im_/http://www.elgordo.ru:80/img/footbal.jpg', 'webarch_url': 'https://web.archive.org/web/20150925074252im_/http://www.elgordo.ru:80/img/footbal.jpg', 'response': 200}, 'https://www.positivessl.com/images-new/PositiveSSL_tl_white2.png': {'page_url': 'https://web.archive.org/web/20150925074252im_/https://www.positivessl.com/images-new/PositiveSSL_tl_white2.png', 'webarch_url': 'https://web.archive.org/web/20150925074252im_/https://www.positivessl.com/images-new/PositiveSSL_tl_white2.png', 'response': 200}, 'http://www.elgordo.ru:80/inc/css/lottery.css': {'page_url': '/web/20150925074252cs_/http://www.elgordo.ru:80/inc/css/lottery.css', 'webarch_url': 'https://web.archive.org/web/20150925074252cs_/http://www.elgordo.ru:80/inc/css/lottery.css', 'response': 200}, 'http://www.elgordo.ru/info.html': {'page_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/info.html', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/info.html', 'response': 200}, 'http://www.elgordo.ru/newsn.html': {'page_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/newsn.html', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/newsn.html', 'response': 200}, 'http://www.elgordo.ru/feedback.php': {'page_url': '/feedback.php', 'webarch_url': 'none', 'response': 403}, 'http://www.elgordo.ru:80/img/favicon.ico': {'page_url': '/web/20150925074252im_/http://www.elgordo.ru:80/img/favicon.ico', 'webarch_url': 'https://web.archive.org/web/20150925074252im_/http://www.elgordo.ru:80/img/favicon.ico', 'response': 404}, 'https://www.positivessl.com/': {'page_url': 'https://web.archive.org/web/20150925074252/https://www.positivessl.com/', 'webarch_url': 'https://web.archive.org/web/20150925074252/https://www.positivessl.com/', 'response': 200}, 'http://www.elgordo.ru/news.html': {'page_url': '/news.html', 'webarch_url': 'none', 'response': 200}, 'http://www.elgordo.ru:80/inc/billprint.html': {'page_url': '/web/20150925074252/http://www.elgordo.ru:80/inc/billprint.html', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru:80/inc/billprint.html', 'response': 404}, 'http://www.elgordo.ru/igry_razuma.html': {'page_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/igry_razuma.html', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/igry_razuma.html', 'response': 200}, 'http://www.elgordo.ru/allresults.html': {'page_url': '/allresults.html', 'webarch_url': 'none', 'response': 200}, 'http://loteriasyapuestas.es/es': {'page_url': 'https://web.archive.org/web/20150925074252/http://loteriasyapuestas.es/es', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://loteriasyapuestas.es/es', 'response': 200}, 'http://www.elgordo.ru/fakty_ob_elgordo.html': {'page_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/fakty_ob_elgordo.html', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/fakty_ob_elgordo.html', 'response': 200}, 'http://www.elgordo.ru:80/inc/css/pages.css': {'page_url': '/web/20150925074252cs_/http://www.elgordo.ru:80/inc/css/pages.css', 'webarch_url': 'https://web.archive.org/web/20150925074252cs_/http://www.elgordo.ru:80/inc/css/pages.css', 'response': 200}, 'http://www.elgordo.ru/contacts.html': {'page_url': '/contacts.html', 'webarch_url': 'none', 'response': 200}, 'http://base.consultant.ru/cons/cgi/online.cgi?req=doc;base=law;n=149747': {'page_url': 'https://web.archive.org/web/20150925074252/http://base.consultant.ru/cons/cgi/online.cgi?req=doc;base=law;n=149747', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://base.consultant.ru/cons/cgi/online.cgi?req=doc;base=law;n=149747', 'response': 200}, 'http://www.elgordo.ru:80/img/logo.gif': {'page_url': '/web/20150925074252im_/http://www.elgordo.ru:80/img/logo.gif', 'webarch_url': 'https://web.archive.org/web/20150925074252im_/http://www.elgordo.ru:80/img/logo.gif', 'response': 200}, 'https://www.national-lottery.co.uk/games/euromillions': {'page_url': 'https://web.archive.org/web/20150925074252/https://www.national-lottery.co.uk/games/euromillions', 'webarch_url': 'https://web.archive.org/web/20150925074252/https://www.national-lottery.co.uk/games/euromillions', 'response': 200}, 'http://www.elgordo.ru:80/img/shtamp.jpg': {'page_url': '/web/20150925074252im_/http://www.elgordo.ru:80/img/shtamp.jpg', 'webarch_url': 'https://web.archive.org/web/20150925074252im_/http://www.elgordo.ru:80/img/shtamp.jpg', 'response': 200}, 'http://ssl.comodo.com/': {'page_url': 'https://web.archive.org/web/20150925074252/http://ssl.comodo.com/', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://ssl.comodo.com/', 'response': 200}, 'http://www.elgordo.ru/bruho_de_oro.html': {'page_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/bruho_de_oro.html', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/bruho_de_oro.html', 'response': 200}, 'http://www.elgordo.ru/yspeh.html': {'page_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/yspeh.html', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/yspeh.html', 'response': 200}, 'http://www.elgordo.ru:80/engine8/jquery.js': {'page_url': '/web/20150925074252js_/http://www.elgordo.ru:80/engine8/jquery.js', 'webarch_url': 'https://web.archive.org/web/20150925074252js_/http://www.elgordo.ru:80/engine8/jquery.js', 'response': 404}, 'http://www.elgordo.ru/history.html': {'page_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/history.html', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru/history.html', 'response': 200}, 'http://ssl.comodo.com/images/comodo_secure_100x85_white.png': {'page_url': 'https://web.archive.org/web/20150925074252im_/http://ssl.comodo.com/images/comodo_secure_100x85_white.png', 'webarch_url': 'https://web.archive.org/web/20150925074252im_/http://ssl.comodo.com/images/comodo_secure_100x85_white.png', 'response': 200}, 'http://www.elgordo.ru:80/inc/js/lottery.js': {'page_url': '/web/20150925074252js_/http://www.elgordo.ru:80/inc/js/lottery.js', 'webarch_url': 'https://web.archive.org/web/20150925074252js_/http://www.elgordo.ru:80/inc/js/lottery.js', 'response': 404}, 'http://www.elgordo.ru:80/engine8/style.css': {'page_url': '/web/20150925074252cs_/http://www.elgordo.ru:80/engine8/style.css', 'webarch_url': 'https://web.archive.org/web/20150925074252cs_/http://www.elgordo.ru:80/engine8/style.css', 'response': 404}, 'http://www.elgordo.ru:80/inc/js/clock24.js': {'page_url': '/web/20150925074252js_/http://www.elgordo.ru:80/inc/js/clock24.js', 'webarch_url': 'https://web.archive.org/web/20150925074252js_/http://www.elgordo.ru:80/inc/js/clock24.js', 'response': 404}, 'http://www.elgordo.ru:80/inc/css/reset.css': {'page_url': '/web/20150925074252cs_/http://www.elgordo.ru:80/inc/css/reset.css', 'webarch_url': 'https://web.archive.org/web/20150925074252cs_/http://www.elgordo.ru:80/inc/css/reset.css', 'response': 200}, 'http://www.elgordo.ru:80/stat.html': {'page_url': '/web/20150925074252/http://www.elgordo.ru:80/stat.html', 'webarch_url': 'https://web.archive.org/web/20150925074252/http://www.elgordo.ru:80/stat.html', 'response': 200}}
domain = 'elgordo.ru'


class UrlReplace:
    def __init__(self):
        self.doc = str()
        self.filename = str()

    # open file
    def file_open(self, filename):
        self.filename = filename
        with open(filename, 'rb') as file:
            doc = file.read()
            self.doc = doc.decode(chardet.detect(doc)['encoding'])

    #todo replace urls
    def replace_urls(self, urls_dict, domain):
        for item, value in urls_dict.items():
                if domain in item:
                    relative_url = URL(item).path
                    if value['page_url'].startswith('/web/'):
                        print(value['page_url'], relative_url)
                        self.doc = self.doc.replace(value['page_url'], relative_url)
                    elif value['page_url'].startswith('https://web.archive.org/web/'):
                        print(value['page_url'], relative_url)
                        self.doc = self.doc.replace(value['page_url'], relative_url)
                    elif not value['page_url'].startswith('/'):
                        print(value['page_url'])
                        self.doc = self.doc.replace(value['page_url'], '')
                else:
                    self.doc = self.doc.replace(value['page_url'], '')

    def replace_charset(self):
        self.doc = self.doc.replace('charset=windows-1251"', 'charset="utf-8"')



    # save file
    def file_save(self):
        with open(self.filename, 'w') as file:
            file.write(self.doc)


if __name__ == '__main__':
    url_replace = UrlReplace()
    url_replace.file_open('rules.html')
    url_replace.replace_urls(url_dicts, domain)
    url_replace.replace_charset()
    url_replace.file_save()
    print('doc', url_replace.doc)